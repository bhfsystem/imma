{
  "data": {
    "terraform_remote_state": {
      "env": {
        "backend": "local",
        "config": {
          "path": "../../env/${var.env_name}/.terraform/terraform.tfstate"
        }
      },
      "global": {
        "backend": "local",
        "config": {
          "path": "../../env/global/.terraform/terraform.tfstate"
        }
      }
    }
  },
  "module": {
    "app": {
      "app_name": "${var.app_name}",
      "az_count": "${var.az_count}",
      "env_remote_state": "${data.terraform_remote_state.env.config[\"path\"]}",
      "global_remote_state": "${data.terraform_remote_state.global.config[\"path\"]}",
      "source": "../../module/app"
    },
    "aptly": {
      "app_name": "${var.app_name}",
      "az_count": "${var.az_count}",
      "env_remote_state": "../../env/${var.env_name}/.terraform/terraform.tfstate",
      "global_remote_state": "../../env/global/.terraform/terraform.tfstate",
      "instance_type": [
        "${lookup(var.instance_type,\"aptly\",\"t2.nano\")}"
      ],
      "public_key": "${var.public_key}",
      "public_network": "${lookup(var.public_network,\"aptly\",\"0\")}",
      "security_groups": [
        "${module.app.app_sg}"
      ],
      "service_name": "aptly",
      "service_nets": [
        "${data.terraform_remote_state.global.service_nets.aptly}"
      ],
      "source": "../../module/service",
      "user_data": "${var.user_data}",
      "want_fs": "${lookup(var.want_fs,\"aptly\",\"0\")}"
    },
    "dns": {
      "app_name": "${var.app_name}",
      "az_count": "${var.az_count}",
      "env_remote_state": "../../env/${var.env_name}/.terraform/terraform.tfstate",
      "global_remote_state": "../../env/global/.terraform/terraform.tfstate",
      "instance_type": [
        "${lookup(var.instance_type,\"dns\",\"t2.nano\")}"
      ],
      "public_key": "${var.public_key}",
      "public_network": "${lookup(var.public_network,\"dns\",\"0\")}",
      "security_groups": [
        "${module.app.app_sg}"
      ],
      "service_name": "dns",
      "service_nets": [
        "${data.terraform_remote_state.global.service_nets.dns}"
      ],
      "source": "../../module/service",
      "user_data": "${var.user_data}",
      "want_fs": "${lookup(var.want_fs,\"dns\",\"0\")}"
    },
    "nexus": {
      "app_name": "${var.app_name}",
      "az_count": "${var.az_count}",
      "env_remote_state": "../../env/${var.env_name}/.terraform/terraform.tfstate",
      "global_remote_state": "../../env/global/.terraform/terraform.tfstate",
      "instance_type": [
        "${lookup(var.instance_type,\"nexus\",\"t2.nano\")}"
      ],
      "public_key": "${var.public_key}",
      "public_network": "${lookup(var.public_network,\"nexus\",\"0\")}",
      "security_groups": [
        "${module.app.app_sg}"
      ],
      "service_name": "nexus",
      "service_nets": [
        "${data.terraform_remote_state.global.service_nets.nexus}"
      ],
      "source": "../../module/service",
      "user_data": "${var.user_data}",
      "want_fs": "${lookup(var.want_fs,\"nexus\",\"0\")}"
    },
    "ntp": {
      "app_name": "${var.app_name}",
      "az_count": "${var.az_count}",
      "env_remote_state": "../../env/${var.env_name}/.terraform/terraform.tfstate",
      "global_remote_state": "../../env/global/.terraform/terraform.tfstate",
      "instance_type": [
        "${lookup(var.instance_type,\"ntp\",\"t2.nano\")}"
      ],
      "public_key": "${var.public_key}",
      "public_network": "${lookup(var.public_network,\"ntp\",\"0\")}",
      "security_groups": [
        "${module.app.app_sg}"
      ],
      "service_name": "ntp",
      "service_nets": [
        "${data.terraform_remote_state.global.service_nets.ntp}"
      ],
      "source": "../../module/service",
      "user_data": "${var.user_data}",
      "want_fs": "${lookup(var.want_fs,\"ntp\",\"0\")}"
    }
  },
  "output": {
    "app_sg": {
      "value": "${module.app.app_sg}"
    }
  },
  "provider": {
    "aws": {
      "region": "${data.terraform_remote_state.env.aws_region}"
    }
  },
  "variable": {
    "app_name": {
      "default": "cache"
    },
    "az_count": {
      "default": "4"
    },
    "env_name": {
      "default": "admin"
    },
    "instance_type": {
      "default": {}
    },
    "public_key": {
      "default": "etc/ssh-key-pair.pub"
    },
    "public_network": {
      "default": {}
    },
    "user_data": {
      "default": "etc/user-data.template"
    },
    "want_fs": {
      "default": {}
    }
  }
}
