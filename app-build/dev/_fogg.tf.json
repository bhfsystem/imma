{
  "data": {
    "terraform_remote_state": {
      "env": {
        "backend": "local",
        "config": {
          "path": "../../env/${var.env_name}/.terraform/terraform.tfstate"
        }
      },
      "global": {
        "backend": "local",
        "config": {
          "path": "../../env/global/.terraform/terraform.tfstate"
        }
      }
    }
  },
  "module": {
    "app": {
      "app_name": "${var.app_name}",
      "az_count": "${var.az_count}",
      "env_remote_state": "${data.terraform_remote_state.env.config[\"path\"]}",
      "global_remote_state": "${data.terraform_remote_state.global.config[\"path\"]}",
      "source": "../../module/app"
    },
    "blocks": {
      "app_name": "${var.app_name}",
      "az_count": "${var.az_count}",
      "env_remote_state": "../../env/${var.env_name}/.terraform/terraform.tfstate",
      "global_remote_state": "../../env/global/.terraform/terraform.tfstate",
      "instance_type": [
        "${lookup(var.instance_type,\"blocks\",\"t2.nano\")}"
      ],
      "public_key": "${var.public_key}",
      "public_network": "${lookup(var.public_network,\"blocks\",\"0\")}",
      "security_groups": [
        "${module.app.app_sg}"
      ],
      "service_name": "blocks",
      "service_nets": [
        "${data.terraform_remote_state.global.service_nets.blocks}"
      ],
      "source": "../../module/service",
      "user_data": "${var.user_data}",
      "want_fs": "${lookup(var.want_fs,\"blocks\",\"0\")}"
    },
    "packer": {
      "app_name": "${var.app_name}",
      "az_count": "${var.az_count}",
      "env_remote_state": "../../env/${var.env_name}/.terraform/terraform.tfstate",
      "global_remote_state": "../../env/global/.terraform/terraform.tfstate",
      "instance_type": [
        "${lookup(var.instance_type,\"packer\",\"t2.nano\")}"
      ],
      "public_key": "${var.public_key}",
      "public_network": "${lookup(var.public_network,\"packer\",\"0\")}",
      "security_groups": [
        "${module.app.app_sg}"
      ],
      "service_name": "packer",
      "service_nets": [
        "${data.terraform_remote_state.global.service_nets.packer}"
      ],
      "source": "../../module/service",
      "user_data": "${var.user_data}",
      "want_fs": "${lookup(var.want_fs,\"packer\",\"0\")}"
    }
  },
  "output": {
    "app_sg": {
      "value": "${module.app.app_sg}"
    }
  },
  "provider": {
    "aws": {
      "region": "${data.terraform_remote_state.env.aws_region}"
    }
  },
  "variable": {
    "app_name": {
      "default": "build"
    },
    "az_count": {
      "default": "3"
    },
    "env_name": {
      "default": "dev"
    },
    "instance_type": {
      "default": {}
    },
    "public_key": {
      "default": "etc/ssh-key-pair.pub"
    },
    "public_network": {
      "default": {}
    },
    "user_data": {
      "default": "etc/user-data.template"
    },
    "want_fs": {
      "default": {}
    }
  }
}
